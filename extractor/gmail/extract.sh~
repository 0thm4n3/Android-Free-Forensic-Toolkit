#!/bin/bash

if [ ! -d $1/extracted\ data/ ]; then		#Makes required folders if they don't exist
mkdir $1/extracted\ data/
fi
if [ ! -d $1/extracted\ data/gmail ]; then
mkdir $1/extracted\ data/gmail/
fi
ourPath=$(pwd)
ls -1 $1/mount/userdata/data/com.google.android.gm/databases | grep -e "mailstore" | grep -v "db-wal" | grep -v "db.shm" | while read -r accountdb;
do
account=$(echo $accountdb | sed 's/mailstore.//' | sed 's/.db//')
mkdir $1/extracted\ data/gmail/$account
mkdir $1/extracted\ data/gmail/$account/db
cp $1/mount/userdata/data/com.google.android.gm/databases/$accountdb $1/extracted\ data/gmail/$account/db/mailstore.db
chmod 755 $1/extracted\ data/gmail/$account/db/mailstore.db
sqlite3 $1/extracted\ data/gmail/$account/db/mailstore.db < /opt/afft/extractor/gmail/messages.sql > $1/extracted\ data/gmail/$account/messages
done
